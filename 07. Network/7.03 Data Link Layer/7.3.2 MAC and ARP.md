# MAC 주소와 ARP 프로토콜

## 1. MAC 주소 (Media Access Control Address)

### MAC 주소란?

- **물리적 주소** 또는 **하드웨어 주소**라고도 함
- 네트워크 인터페이스 카드(NIC)에 고유하게 할당된 식별자
- 데이터 링크 계층에서 사용되는 주소 체계
- **전 세계적으로 유일한 주소** (이론적으로)

### MAC 주소 구조

**48비트 (6바이트) 길이**

```
┌─────────────────┬─────────────────┐
│       OUI       │       NIC       │
│ (24비트, 3바이트) │ (24비트, 3바이트)│
└─────────────────┴─────────────────┘

예시: 00:1A:2B:3C:4D:5E
```

**OUI (Organizationally Unique Identifier)**

- IEEE에서 각 제조업체에 할당하는 고유 식별자
- 앞 3바이트 (24비트)
- 예시:
  - Apple: 00:1A:2B
  - Intel: 00:15:17
  - Samsung: 00:12:FB

**NIC 식별자**

- 제조업체가 자체적으로 할당하는 일련번호
- 뒤 3바이트 (24비트)
- 같은 제조업체 내에서 유일해야 함

### MAC 주소 표기법

**콜론 표기법** (리눅스/맥 OS)

```
00:1A:2B:3C:4D:5E
```

**하이픈 표기법** (윈도우)

```
00-1A-2B-3C-4D-5E
```

**점 표기법** (시스코)

```
001A.2B3C.4D5E
```

### 특수 MAC 주소

**브로드캐스트 주소**

```
FF:FF:FF:FF:FF:FF (모든 비트가 1)
```

- 같은 네트워크의 모든 장치에 전송

**멀티캐스트 주소**

```
첫 번째 바이트의 LSB = 1
예: 01:00:5E:xx:xx:xx (IPv4 멀티캐스트)
```

**유니캐스트 주소**

```
첫 번째 바이트의 LSB = 0
일반적인 일대일 통신 주소
```

## 2. ARP 프로토콜 (Address Resolution Protocol)

### ARP란?

- **IP 주소를 MAC 주소로 변환**하는 프로토콜
- 네트워크 계층(IP)과 데이터 링크 계층(MAC) 간의 다리 역할
- RFC 826에서 정의

### ARP가 필요한 이유

**계층별 주소 체계**

```
응용 계층: 도메인 이름 (www.example.com)
   ↓ DNS
네트워크 계층: IP 주소 (192.168.1.10)
   ↓ ARP
데이터링크 계층: MAC 주소 (00:1A:2B:3C:4D:5E)
```

- IP 패킷을 전송하려면 목적지의 MAC 주소가 필요
- 라우터나 같은 네트워크의 장치와 통신할 때 MAC 주소 필요

### ARP 패킷 구조

```
┌─────────────────┬─────────────────┬─────────────────┬───────────────┐
│   하드웨어 타입   │   프로토콜 타입   │ 하드웨어 주소길이  │프로토콜 주소길이│
│   (2바이트)      │    (2바이트)     │     (1바이트)    │   (1바이트)    │
├─────────────────┼─────────────────┴─────────────────┴───────────────┤
│     연산 코드    │                                                   │
│    (2바이트)     │                                                   │
├─────────────────┼───────────────────────────────────────────────────┤
│                      송신자 하드웨어 주소 (6바이트)                     │
├─────────────────────────────────────────────────────────────────────┤
│                      송신자 프로토콜 주소 (4바이트)                     │
├─────────────────────────────────────────────────────────────────────┤
│                       목표 하드웨어 주소 (6바이트)                      │
├─────────────────────────────────────────────────────────────────────┤
│                       목표 프로토콜 주소 (4바이트)                      │
└─────────────────────────────────────────────────────────────────────┘
```

**주요 필드 설명:**

- **하드웨어 타입**: 1 (이더넷)
- **프로토콜 타입**: 0x0800 (IPv4)
- **연산 코드**: 1(ARP 요청), 2(ARP 응답)

### ARP 동작 과정

**시나리오**: 호스트 A(192.168.1.10)가 호스트 B(192.168.1.20)와 통신

#### 1단계: ARP 요청 (Request)

```
송신자: 호스트 A
목적지: 브로드캐스트 (FF:FF:FF:FF:FF:FF)

ARP 요청 내용:
- 송신자 IP: 192.168.1.10
- 송신자 MAC: AA:BB:CC:DD:EE:FF
- 목표 IP: 192.168.1.20
- 목표 MAC: 00:00:00:00:00:00 (모름)
```

#### 2단계: ARP 응답 (Reply)

```
송신자: 호스트 B
목적지: 호스트 A (AA:BB:CC:DD:EE:FF)

ARP 응답 내용:
- 송신자 IP: 192.168.1.20
- 송신자 MAC: 11:22:33:44:55:66
- 목표 IP: 192.168.1.10
- 목표 MAC: AA:BB:CC:DD:EE:FF
```

#### 3단계: ARP 테이블 업데이트

```
호스트 A의 ARP 테이블:
IP 주소         MAC 주소           타입     TTL
192.168.1.20   11:22:33:44:55:66  동적    300초
```

### ARP 테이블 관리

**ARP 테이블 확인 명령어**

```bash
# Windows
arp -a

# Linux/Mac
arp -a
ip neighbor show
```

**ARP 테이블 예시**

```
IP 주소        물리적 주소        타입
192.168.1.1    aa:bb:cc:dd:ee:ff  동적
192.168.1.20   11:22:33:44:55:66  동적
192.168.1.100  static-entry       정적
```

**TTL (Time To Live)**

- 동적 엔트리: 보통 2-20분 후 만료
- 정적 엔트리: 수동으로 삭제할 때까지 유지

## 3. ARP 관련 공격과 보안

### ARP 스푸핑 (ARP Spoofing)

**공격 방법:**

1. 공격자가 가짜 ARP 응답 전송
2. 피해자의 ARP 테이블에 잘못된 정보 저장
3. 트래픽이 공격자를 거쳐 전송됨

**대응 방법:**

- 정적 ARP 엔트리 사용
- ARP 모니터링 도구 활용
- 스위치의 Dynamic ARP Inspection 기능

### Gratuitous ARP

- 자신의 IP에 대한 ARP 요청을 자신이 전송
- IP 중복 검사
- ARP 테이블 업데이트 강제

## 4. RARP와 기타 프로토콜

### RARP (Reverse ARP)

- **MAC 주소를 IP 주소로 변환**
- 디스크가 없는 워크스테이션에서 사용
- 현재는 DHCP로 대체됨

### Proxy ARP

- 라우터가 다른 네트워크의 호스트를 대신하여 ARP 응답
- 서브넷 간 통신에서 사용
