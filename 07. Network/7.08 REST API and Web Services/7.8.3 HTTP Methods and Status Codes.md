# 7.8.3 HTTP 메서드와 상태 코드 활용

## 1. HTTP 메서드와 CRUD 매핑

### 기본 매핑
- **GET**: 리소스 조회 (Read)
- **POST**: 리소스 생성 (Create)
- **PUT**: 리소스 전체 수정 (Update)
- **PATCH**: 리소스 부분 수정 (Partial Update)
- **DELETE**: 리소스 삭제 (Delete)

### 예시
```text
GET    /articles           → 글 목록 조회
POST   /articles           → 글 생성
GET    /articles/10        → 특정 글 조회
PUT    /articles/10        → 특정 글 전체 수정
PATCH  /articles/10        → 특정 글 일부 수정
DELETE /articles/10        → 특정 글 삭제
```

---

## 2. HTTP 메서드 특성

### 메서드별 특성표

| 메서드 | Safe | Idempotent | 캐시 가능 | 요청 본문 | 설명 |
|--------|------|------------|-----------|-----------|------|
| **GET** | O | O | O | X | 리소스 조회, 서버 상태 변경 없음 |
| **POST** | X | X | X | O | 리소스 생성, 매번 새 리소스 |
| **PUT** | X | O | X | O | 전체 교체, 동일 요청 반복해도 결과 같음 |
| **PATCH** | X | △ | X | O | 부분 수정, 구현에 따라 멱등성 다름 |
| **DELETE** | X | O | X | △ | 리소스 삭제, 이미 없어도 결과 동일 |
| **HEAD** | O | O | O | X | 헤더만 조회, GET과 동일하지만 본문 없음 |
| **OPTIONS** | O | O | X | X | 지원 메서드 조회, CORS에서 주로 사용 |

### 주요 개념 설명

#### 1) Safe (안전한 메서드)
- 서버 상태를 변경하지 않는 메서드
- GET, HEAD, OPTIONS가 해당
- 여러 번 호출해도 서버 리소스에 영향 없음

#### 2) Idempotent (멱등 메서드)
- 동일한 요청을 여러 번 보내도 결과가 같은 메서드
- GET, PUT, DELETE가 해당
- POST는 매번 새 리소스를 생성하므로 비멱등

#### 3) 캐시 가능
- 응답을 캐시할 수 있는 메서드
- 주로 GET 요청이 캐시됨

---

## 3. PUT vs PATCH 상세 비교

### PUT (전체 교체)
```json
// 현재 리소스
{ "id": 1, "name": "Alice", "age": 25, "email": "alice@example.com" }

// PUT 요청
PUT /users/1
{ "name": "Bob", "age": 30 }

// 결과 (전체 교체, email 필드 사라짐)
{ "id": 1, "name": "Bob", "age": 30 }
```

### PATCH (부분 수정)
```json
// 현재 리소스
{ "id": 1, "name": "Alice", "age": 25, "email": "alice@example.com" }

// PATCH 요청
PATCH /users/1
{ "name": "Bob", "age": 30 }

// 결과 (부분 수정, email 필드 유지)
{ "id": 1, "name": "Bob", "age": 30, "email": "alice@example.com" }
```

### 멱등성 차이
- **PUT**: 항상 멱등 (전체 교체이므로 결과 동일)
- **PATCH**: 구현에 따라 다름
  - 멱등: `{ "name": "Bob" }` (값 설정)
  - 비멱등: `{ "age": "+1" }` (증가 연산)

---

## 4. HTTP 상태 코드

### 2xx (성공)
- **200 OK**: GET, PUT, PATCH 성공
- **201 Created**: POST로 리소스 생성 성공
- **202 Accepted**: 요청 접수, 비동기 처리 중
- **204 No Content**: DELETE 성공, 응답 본문 없음

### 3xx (리다이렉션)
- **301 Moved Permanently**: 리소스가 영구적으로 이동
- **302 Found**: 임시 리다이렉션
- **304 Not Modified**: 캐시된 리소스 사용 가능

### 4xx (클라이언트 오류)
- **400 Bad Request**: 잘못된 요청 형식
- **401 Unauthorized**: 인증 필요
- **403 Forbidden**: 권한 없음
- **404 Not Found**: 리소스 없음
- **405 Method Not Allowed**: 지원하지 않는 HTTP 메서드
- **409 Conflict**: 리소스 충돌 (중복 생성, 동시 수정 등)
- **422 Unprocessable Entity**: 요청 형식은 맞지만 검증 실패

### 5xx (서버 오류)
- **500 Internal Server Error**: 서버 내부 오류
- **502 Bad Gateway**: 게이트웨이/프록시 오류
- **503 Service Unavailable**: 서비스 과부하/점검 중
- **504 Gateway Timeout**: 게이트웨이 응답 시간 초과

---

## 5. 활용

### 회원가입 API
```text
POST /users
- 성공: 201 Created
- 이메일 중복: 409 Conflict
- 필드 검증 실패: 422 Unprocessable Entity
- 서버 오류: 500 Internal Server Error
```

### 로그인 API
```text
POST /auth/login
- 성공: 200 OK (토큰 반환)
- 잘못된 자격증명: 401 Unauthorized
- 계정 잠김: 403 Forbidden
```

### 프로필 수정 API
```text
PUT /users/123     → 전체 프로필 교체
PATCH /users/123   → 특정 필드만 수정
- 성공: 200 OK
- 사용자 없음: 404 Not Found
- 권한 없음: 403 Forbidden
```

### 게시글 삭제 API
```text
DELETE /posts/456
- 성공: 204 No Content
- 이미 삭제됨: 204 No Content (멱등성)
- 권한 없음: 403 Forbidden
- 게시글 없음: 404 Not Found
```

---

## 6. 상태 코드 활용 원칙

### 기본 원칙
- **의미에 맞는 정확한 코드** 사용
- **일관된 패턴** 유지 (팀 내 표준화)
- **클라이언트가 이해하기 쉬운** 응답

### 에러 응답 예시
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "입력값이 올바르지 않습니다.",
    "details": [
      {
        "field": "email",
        "message": "이메일 형식이 올바르지 않습니다."
      },
      {
        "field": "password",
        "message": "비밀번호는 8자 이상이어야 합니다."
      }
    ]
  }
}
```

---

## 7. 핵심 요약
- **멱등성**: GET, PUT, DELETE는 멱등, POST는 비멱등
- **PUT vs PATCH**: 전체 교체 vs 부분 수정
- **Safe 메서드**: GET, HEAD, OPTIONS는 서버 상태 변경 없음
- **상태 코드**: 상황에 맞는 정확한 코드로 의미 전달
- **실무 활용**: 비즈니스 로직에 따른 적절한 메서드/코드 선택 필요