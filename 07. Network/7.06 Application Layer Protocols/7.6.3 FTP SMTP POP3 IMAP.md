# 7.6.3 FTP, SMTP, POP3, IMAP

## 1. FTP (File Transfer Protocol)

### 정의
FTP(File Transfer Protocol)는 **TCP 기반의 파일 전송 프로토콜**로, 원격 시스템 간에 파일을 업로드·다운로드할 수 있도록 한다.  
RFC 959에 정의되어 있으며, **TCP 포트 21(제어), 20(데이터)** 를 기본적으로 사용한다.

### 주요 특징
- **클라이언트-서버 구조**
    - 클라이언트: 명령 전송
    - 서버: 명령 수신 및 응답
- **제어 채널과 데이터 채널 분리**
    - 제어 채널(21번): 명령과 응답 교환
    - 데이터 채널(20번): 실제 파일 데이터 전송
- **양방향 전송 지원**: 업로드, 다운로드 가능
- **인증 방식**: 계정 기반 로그인, Anonymous 모드 지원

### 동작 모드
- **Active Mode**
    - 클라이언트 → 서버(21번 포트, 제어 연결)
    - 서버 → 클라이언트(데이터 포트, 20번에서 임의 포트로 연결)
    - 방화벽·NAT 환경에서 제약이 많음
- **Passive Mode**
    - 클라이언트가 서버에 PASV 명령 전송
    - 서버가 사용할 임시 포트를 알려줌
    - 클라이언트가 해당 포트로 접속하여 데이터 채널 생성
    - 방화벽 우회에 유리

### FTP 보안
- 기본 FTP는 평문 전송 → 보안 취약
- 대안: **FTPS(SSL/TLS 기반)**, **SFTP(SSH 기반)**

### 활용 예시
- 웹 서버 파일 업로드/배포
- 기업 내부 파일 교환 시스템
- 옛날 시스템에서 소프트웨어 패치 배포

---

## 2. SMTP (Simple Mail Transfer Protocol)

### 정의
SMTP(Simple Mail Transfer Protocol)는 **이메일을 송신(전송)하기 위한 프로토콜**로,  
주로 **TCP 포트 25**(기본), **587(메일 전송, Submission)**, **465(SSL/TLS 기반, SMTPS)** 를 사용한다.

### 주요 특징
- **텍스트 기반 프로토콜**: 명령어와 응답 코드로 동작
- **스토어 앤드 포워드(Store and Forward)** 방식
    - 메일 서버 간 릴레이(relay)를 통해 최종 수신자에게 전달
- **PUSH 방식**: 발신자가 수신자 측 메일 서버로 메일을 "밀어 넣음"
- **헤더와 본문 분리**
    - 헤더: 송신자, 수신자, 제목 등 메타데이터
    - 본문: 실제 메시지 내용
- **보안 확장**: STARTTLS 명령을 통해 TLS 암호화 지원

### 동작 과정
1. 송신자 메일 클라이언트(MUA) → SMTP 서버(MSA)
2. SMTP 서버 → 중계 서버(MTA)
3. 최종 수신자의 SMTP 서버(MDA)에 도착
4. 수신자는 POP3/IMAP을 통해 메일 확인

### SMTP 명령어 예시
- `HELO` / `EHLO`: 서버 인사
- `MAIL FROM:` 송신자 지정
- `RCPT TO:` 수신자 지정
- `DATA`: 본문 전송 시작
- `QUIT`: 세션 종료

### 한계
- 본래 **메일 수신은 지원하지 않음** → POP3/IMAP 필요
- 인증·암호화 부족 → 스팸 메일, 피싱 공격에 악용 가능

### 활용 예시
- Gmail, Outlook 등 모든 메일 서비스의 **송신 프로토콜**
- 서버 모니터링 알림 메일 발송

---

## 3. POP3 (Post Office Protocol v3)

### 정의
POP3(Post Office Protocol v3)는 **메일 서버에 저장된 이메일을 클라이언트로 가져오기(수신)** 위한 프로토콜이다.  
주로 **TCP 포트 110**, 보안 연결 시 **995(POP3S)** 를 사용한다.

### 주요 특징
- **다운로드 & 삭제 방식**
    - 기본적으로 서버에서 메일을 다운로드한 후 삭제
    - 일부 설정 시 서버에 복사본 남길 수 있음
- **간단한 구조**
    - 동기화 기능이 거의 없음 → 여러 기기에서 사용 시 불편
- **텍스트 기반 명령어 프로토콜**
- **단일 메일박스** 중심: 복잡한 폴더 구조 지원 X

### 동작 과정
1. 클라이언트(MUA)가 POP3 서버에 접속
2. 사용자 인증 (ID/PW)
3. 메일 목록 요청
4. 메일 다운로드 후 서버에서 삭제(기본)
5. 연결 종료

### POP3 명령어 예시
- `USER`: 사용자 계정
- `PASS`: 비밀번호
- `LIST`: 메일 목록
- `RETR n`: n번째 메일 가져오기
- `DELE n`: n번째 메일 삭제
- `QUIT`: 세션 종료

### 장점
- **로컬 보관**: 인터넷 연결 없이도 메일 확인 가능
- **단순하고 빠름**
- **서버 저장소 부담 적음**

### 단점
- **동기화 부족**: 여러 기기에서 메일 상태(읽음/삭제)가 공유되지 않음
- **메일 손실 위험**: 다운로드 후 서버 삭제 시 백업 없으면 복구 불가
- **폴더 구조/고급 기능 제한적**

### 활용 예시
- 과거 데스크톱 메일 클라이언트(Outlook Express 등)에서 주로 사용
- 지금은 IMAP이 대체했지만 일부 경량 클라이언트에서 여전히 사용

---

## 4. IMAP (Internet Message Access Protocol)

### 정의
IMAP(Internet Message Access Protocol)은 **메일 서버에 저장된 이메일을 클라이언트에서 원격으로 관리**할 수 있는 프로토콜이다.  
주로 **TCP 포트 143**, 보안 연결 시 **993(IMAPS)** 를 사용한다.

### 주요 특징
- **서버 중심 구조**
    - 메일이 서버에 그대로 저장됨
    - 여러 기기에서 동일한 메일 상태 동기화 가능
- **부분 다운로드 지원**
    - 메일 제목/본문 일부만 가져와 빠른 확인 가능
- **폴더 및 태그 관리**
    - 서버에 폴더 구조 유지 가능
- **텍스트 기반 명령어 프로토콜**

### 동작 방식
1. 클라이언트가 IMAP 서버 접속
2. 사용자 인증
3. 서버의 메일 목록/상태 동기화
4. 필요 시 메일 전체 or 일부 다운로드
5. 읽음/삭제/이동 등의 작업이 서버와 즉시 동기화

### IMAP 명령어 예시
- `LOGIN`: 사용자 인증
- `LIST`: 메일박스 목록
- `SELECT`: 특정 메일박스 선택
- `FETCH`: 메일 내용 가져오기
- `STORE`: 메일 상태(읽음/안읽음 등) 변경
- `LOGOUT`: 연결 종료

### 장점
- **멀티 디바이스 동기화**: 여러 기기에서 동일한 상태 유지
- **서버 관리 중심**: 폴더 구조/태그 등 관리 가능
- **부분 다운로드로 효율적 사용 가능**

### 단점
- **서버 의존도 높음**: 오프라인에서 제한적 사용
- **서버 저장소 부담**: 메일이 서버에 계속 남음
- **구현 복잡도**: POP3보다 명령어/상태 관리가 복잡

### 활용 예시
- Gmail, Outlook, Yahoo 등 대부분의 현대 이메일 서비스
- 모바일/데스크톱에서 동일한 메일 환경 제공
