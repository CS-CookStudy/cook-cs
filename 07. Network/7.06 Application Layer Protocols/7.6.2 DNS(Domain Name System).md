# 7.6.2 DNS (Domain Name System)

## 1. DNS 개요

### 정의
DNS는 사람이 이해하기 쉬운 **도메인 이름(www.example.com)** 을  
네트워크가 사용하는 **IP 주소(203.0.113.1)** 로 변환해주는 분산형 데이터베이스 시스템이다.

👉 **인터넷의 전화번호부 역할**

### 주요 특징
- **분산형 구조**: 전 세계에 분산된 네임서버들이 협력
- **계층적 구조**: Root → TLD → Authoritative DNS 순서
- **캐싱 지원**: TTL 기반으로 성능 최적화
- **기본 포트**: UDP 53번 (대용량 응답 시 TCP 53번)

---

## 2. DNS 동작 원리

### 기본 흐름
1. 사용자가 브라우저에 `www.example.com` 입력
2. **브라우저 캐시** 확인 (이전에 접속 기록이 있는 경우)
3. **OS 캐시 (hosts 파일, 로컬 DNS 캐시)** 확인
4. **로컬 DNS 리졸버(Resolver)**에 질의
5. 순차적으로 네임서버 탐색
    - Root DNS 서버 → TLD 서버(.com, .net 등) → Authoritative 서버(해당 도메인 담당)
6. 최종 IP 주소 반환 후, 브라우저가 해당 IP로 연결

### 상세 해석 과정 예시
```
사용자: www.example.com 접속

1. 로컬 DNS → Root 서버: "www.example.com의 IP는?"
   Root: ".com을 담당하는 TLD 서버는 xxx.xxx.xxx.xxx"

2. 로컬 DNS → .com TLD 서버: "www.example.com의 IP는?"
   TLD: "example.com을 담당하는 서버는 yyy.yyy.yyy.yyy"

3. 로컬 DNS → example.com Authoritative: "www.example.com의 IP는?"
   Authoritative: "93.184.216.34"

4. 로컬 DNS → 브라우저: "93.184.216.34"
```

---

## 3. DNS 계층 구조

```
Root (.)
 ├── TLD(.com, .org, .net, .kr, .jp ...)
 │    └── Second-level Domain (example.com, google.com)
 │          └── Subdomain (www.example.com, mail.example.com)
```

### 각 계층의 역할

#### 1) Root 서버
- **전 세계 13개 루트 서버 클러스터** (A~M)
- 최상위 도메인(TLD) 정보 관리
- 모든 DNS 질의의 출발점

#### 2) TLD (Top-Level Domain) 서버
- **일반 TLD**: .com, .org, .net, .info 등
- **국가 TLD**: .kr(한국), .jp(일본), .us(미국) 등
- **신규 TLD**: .shop, .blog, .tech 등

#### 3) Authoritative DNS 서버 (= Second-level Domain 서버)
- example.com, google.com 등의 실제 도메인을 관리하는 서버
- 특정 도메인의 **최종 권한**을 가진 서버
- A, AAAA, CNAME 등 실제 레코드 정보 보관
- 도메인 소유자가 관리하거나 DNS 서비스 업체에 위임

---

## 4. DNS 레코드 종류

| 레코드 | 설명 | 예시 |
|--------|------|------|
| **A** | 도메인 → IPv4 주소 매핑 | `example.com → 93.184.216.34` |
| **AAAA** | 도메인 → IPv6 주소 매핑 | `example.com → 2606:2800:220:1:248:1893:25c8:1946` |
| **CNAME** | 별칭(Alias) 설정 | `www.example.com → example.com` |
| **MX** | 메일 서버 정보 (우선순위 포함) | `example.com → 10 mail.example.com` |
| **NS** | 네임서버 정보 | `example.com → ns1.example.com` |
| **TXT** | 인증/부가정보 (SPF, DKIM 등) | `v=spf1 include:_spf.google.com ~all` |
| **PTR** | 역방향 조회 (IP → 도메인) | `34.216.184.93.in-addr.arpa → example.com` |
| **SOA** | 도메인 권한 정보 | 시리얼 번호, 갱신 주기, TTL 등 |

---

## 5. DNS 캐싱과 TTL

### 캐싱 단계
1. **브라우저 캐시**: 브라우저별 내장 캐시
2. **OS 캐시**: hosts 파일, DNS Client Service
3. **로컨 DNS 서버 캐시**: ISP나 조직 내 DNS 서버
4. **Authoritative 서버**: 원본 데이터

### TTL (Time To Live)
- **정의**: DNS 레코드가 캐시에 저장되는 시간(초 단위)
- **예시**: TTL 3600 = 1시간 동안 캐시 유지
- **트레이드오프**:
    - TTL 길게 → 성능 좋음, 변경 반영 느림
    - TTL 짧게 → 변경 반영 빠름, DNS 질의 부하 증가

👉 캐싱을 통해 **성능 향상, 불필요한 DNS 질의 감소**

---

## 6. DNS 질의 방식

### 1) 재귀적 질의 (Recursive Query)
- 로컬 DNS가 **최종 답변을 찾을 때까지** 대신 탐색
- 클라이언트는 한 번만 질의하고 완전한 답변 수신

### 2) 반복적 질의 (Iterative Query)
- 각 서버가 **다음 서버 정보만** 알려줌
- 클라이언트가 직접 여러 서버에 순차 질의

### 일반적 조합
- **클라이언트 ↔ 로컬 DNS**: 재귀적 질의
- **로컬 DNS ↔ Root/TLD/Authoritative**: 반복적 질의

---

## 7. DNS 보안 이슈와 해결책

### 주요 보안 위협
1. **DNS 스푸핑/포이즈닝**: 가짜 DNS 응답으로 잘못된 IP 전달
2. **DNS 하이재킹**: DNS 설정 변경으로 트래픽 우회
3. **DDoS 공격**: DNS 서버 과부하로 서비스 마비

### 보안 강화 방법
- **DNSSEC**: 디지털 서명으로 DNS 응답 무결성 검증
- **DNS over HTTPS (DoH)**: HTTPS로 DNS 질의 암호화
- **DNS over TLS (DoT)**: TLS로 DNS 질의 암호화

---

## 8. 실제 활용 예시

### 웹사이트 접속 과정
`www.google.com` 접속 시:
1. **브라우저** → 로컬 DNS (캐시 확인)
2. 없으면 **Root 서버** → **TLD(.com)** → **Authoritative DNS**
3. **IP 주소 반환** → TCP/UDP 소켓 연결 시작
4. HTTP/HTTPS 요청 전송

### DNS 장애 시 영향
- 2016년 Dyn DNS 대란: Twitter, Netflix, Spotify 등 접속 불가
- 2021년 Cloudflare 장애: 수많은 웹사이트 일시 접속 중단

👉 DNS는 **인터넷 인프라의 핵심**, 장애 시 광범위한 영향

---

## 9. 핵심 요약

- **DNS = 인터넷 전화번호부** (도메인 ↔ IP 매핑)
- **계층 구조**: Root → TLD → Authoritative
- **주요 레코드**: A, AAAA, CNAME, MX, NS, TXT
- **캐싱**: TTL 기반 성능 향상
- **질의 방식**: 재귀적(클라이언트 ↔ 로컬 DNS), 반복적(DNS 서버 간)
- **보안**: DNSSEC, DoH, DoT로 강화
- **중요성**: 인터넷 인프라의 핵심, 장애 시 광범위한 영향