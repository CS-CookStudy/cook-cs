# ICMP 프로토콜

## 1. ICMP 기본 개념

### ICMP란?

- **Internet Control Message Protocol**: 인터넷 제어 메시지 프로토콜
- **네트워크 계층(Layer 3)**에서 동작
- **IP의 보조 프로토콜** 역할
- **오류 보고 및 네트워크 진단** 담당

### ICMP 역할

- 네트워크 오류 상황 보고
- ping, traceroute 같은 진단 도구 지원
- 경로 최적화 정보 제공

ICMP 헤더 구조

```
┌─────────┬─────────┬─────────────────┬─────────────────┐
│  타입   │   코드   │      체크섬      │     추가 필드     │
│ (8비트) │  (8비트) │    (16비트)      │     (32비트)     │
└─────────┴─────────┴─────────────────┴─────────────────┘
│                        데이터                          │
└───────────────────────────────────────────────────────┘

- 타입: ICMP 메시지 종류
- 코드: 해당 타입의 세부 분류
- 체크섬: 오류 검출
- 추가 필드: 타입별 추가 정보
- 데이터: 원본 IP 패킷 일부 (오류 메시지의 경우)
```

IP 패킷 내 ICMP 위치

```
┌─────────────┬─────────────┬─────────────┐
│   IP 헤더    │  ICMP 헤더  │  ICMP 데이터 │
│ Protocol=1  │             │             │
└─────────────┴─────────────┴─────────────┘
```

## 2. 주요 ICMP 메시지

### Echo Request/Reply (타입 8/0)

```
용도: ping 명령 구현
동작:
- Echo Request (타입 8) 전송
- Echo Reply (타입 0) 응답
- 네트워크 연결성 테스트
```

### Destination Unreachable (타입 3)

```
발생 상황:
- 네트워크 도달 불가
- 호스트 도달 불가
- 포트 도달 불가
- 프로토콜 도달 불가

목적: 패킷 전달 실패 원인 알림
```

### Time Exceeded (타입 11)

```
발생 상황:
- TTL 값이 0이 되어 패킷 폐기
- traceroute에서 경로 추적에 활용

목적: 무한 루프 방지 및 경로 추적
```

### Redirect (타입 5)

```
용도: 더 효율적인 경로 정보 제공
발생: 라우터가 비효율적 경로 발견 시
결과: 호스트 라우팅 테이블 업데이트
```

## 3. ICMP 활용 도구

### ping 명령

**기능:** 네트워크 연결성 테스트

```
동작 과정:
1. Echo Request 전송
2. Echo Reply 수신 대기
3. 응답 시간 측정
4. 패킷 손실률 계산
```

**결과 정보:**

- 응답 시간 (RTT)
- TTL 값
- 패킷 손실률

### traceroute (Windows: tracert)

**기능:** 네트워크 경로 추적

```
동작 과정:
1. TTL=1부터 시작하여 패킷 전송
2. 각 라우터에서 Time Exceeded 응답
3. TTL을 1씩 증가시키며 반복
4. 목적지까지의 모든 경로 확인
```

**결과 정보:**

- 경로상 모든 라우터 IP
- 각 구간별 응답 시간
- 병목 지점 파악 가능

## 4. ICMP의 특징

### 장점

- **간단한 구조**: 최소한의 오버헤드
- **표준화**: 모든 IP 구현체에서 지원
- **진단 유용성**: 네트워크 문제 해결에 필수

### 제한사항

- **보안 이슈**: DDoS 공격에 악용 가능
- **방화벽 차단**: 많은 방화벽에서 ICMP 차단
- **신뢰성 없음**: 전달 보장 안함
