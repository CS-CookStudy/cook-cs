# IPv4 주소체계와 NAT

## 1. IPv4 주소 체계

### IPv4 주소 기본 구조

- **32비트 (4바이트)** 길이의 논리적 주소
- **8비트씩 4개 옥텟**으로 구성
- **점으로 구분된 십진수 표기법** (Dotted Decimal Notation)

```
이진수: 11000000.10101000.00000001.00000001
십진수: 192.168.1.1

각 옥텟 범위: 0 ~ 255
전체 주소 개수: 2^32 = 약 43억 개
```

### IPv4 주소 구성

```
┌─────────────────┬─────────────────┐
│    네트워크 ID   │     호스트 ID    │
│    (Network)    │     (Host)      │
└─────────────────┴─────────────────┘

- 네트워크 ID: 네트워크를 식별 (라우팅에 사용)
- 호스트 ID: 해당 네트워크 내 장치 식별
```

### IPv4 클래스 구조

**클래스 A**

```
첫 번째 비트: 0
범위: 1.0.0.0 ~ 126.255.255.255
구조: N.H.H.H
기본 서브넷 마스크: 255.0.0.0 (/8)
```

**클래스 B**

```
첫 두 비트: 10
범위: 128.0.0.0 ~ 191.255.255.255
구조: N.N.H.H
기본 서브넷 마스크: 255.255.0.0 (/16)
```

**클래스 C**

```
첫 세 비트: 110
범위: 192.0.0.0 ~ 223.255.255.255
구조: N.N.N.H
기본 서브넷 마스크: 255.255.255.0 (/24)
```

## 2. 서브넷 마스크와 CIDR

### 서브넷 마스크

- **네트워크 부분과 호스트 부분을 구분**하는 32비트 마스크
- 네트워크 비트는 1, 호스트 비트는 0으로 표시
- IP 주소와 AND 연산하여 네트워크 주소 계산

```
예시: IP 주소 192.168.1.100과 서브넷 마스크 255.255.255.0

IP 주소:      11000000.10101000.00000001.01100100
서브넷 마스크: 11111111.11111111.11111111.00000000
AND 연산:     11000000.10101000.00000001.00000000
결과:         192.168.1.0 (네트워크 주소)
```

### CIDR (Classless Inter-Domain Routing)

- **슬래시 표기법**: IP주소/프리픽스길이
- 클래스 제한을 벗어난 **유연한 주소 할당**
- 라우팅 테이블 크기 축소 효과

```
CIDR 표기법과 서브넷 마스크 대응:
/8  = 255.0.0.0
/16 = 255.255.0.0
/24 = 255.255.255.0
/25 = 255.255.255.128
/26 = 255.255.255.192
/27 = 255.255.255.224
/28 = 255.255.255.240
/29 = 255.255.255.248
/30 = 255.255.255.252
```

### 서브넷 계산 예시

```
네트워크: 192.168.1.0/26

프리픽스 길이: 26비트 (네트워크)
호스트 비트: 6비트 (32-26)
호스트 개수: 2^6 - 2 = 62개 (네트워크/브로드캐스트 주소 제외)

주소 범위:
- 네트워크 주소: 192.168.1.0
- 첫 번째 호스트: 192.168.1.1
- 마지막 호스트: 192.168.1.62
- 브로드캐스트: 192.168.1.63
```

## 3. 공인 IP vs 사설 IP

### 공인 IP (Public IP)

- **인터넷에서 전 세계적으로 유일한 주소**
- **IANA/RIR**에서 할당 및 관리
- 인터넷 라우팅 가능
- **유료 할당** (ISP를 통해)

```
특징:
- 전 세계 어디서든 접근 가능
- 웹 서버, 메일 서버 등에 필수
- IPv4 주소 고갈로 인한 높은 비용
- 직접적인 인터넷 노출 (보안 주의)
```

### 사설 IP (Private IP)

- **내부 네트워크에서만 사용하는 주소**
- **RFC 1918**에서 정의된 특정 주소 대역
- 인터넷에서 라우팅되지 않음
- **무료 사용** 가능

```
사설 IP 대역:
클래스 A: 10.0.0.0/8        (10.0.0.0 ~ 10.255.255.255)
클래스 B: 172.16.0.0/12     (172.16.0.0 ~ 172.31.255.255)
클래스 C: 192.168.0.0/16    (192.168.0.0 ~ 192.168.255.255)
```

### 공인 IP vs 사설 IP 비교

| 구분       | 공인 IP                      | 사설 IP                |
| ---------- | ---------------------------- | ---------------------- |
| **유일성** | 전 세계 유일                 | 네트워크 내에서만 유일 |
| **라우팅** | 인터넷 라우팅 가능           | 인터넷 라우팅 불가     |
| **비용**   | 유료 (ISP 할당)              | 무료                   |
| **보안**   | 직접 노출 위험               | 내부 네트워크 보호     |
| **용도**   | 서버, 라우터 외부 인터페이스 | 내부 PC, 장비          |

## 4. NAT (Network Address Translation)

### NAT란?

- **네트워크 주소 변환**: 사설 IP를 공인 IP로 변환하는 기술
- **라우터나 방화벽**에서 주로 구현
- IPv4 주소 부족 문제의 핵심 해결책
- 내부 네트워크 보안 강화 효과

### NAT 동작 원리

**기본 시나리오:**

```
내부 네트워크: 192.168.1.0/24 (사설 IP)
NAT 라우터 공인 IP: 203.241.132.5
목적지: 8.8.8.8 (Google DNS)
```

**outbound 통신 (내부 → 외부):**

```
1. PC(192.168.1.10:1234) → Google(8.8.8.8:53) 패킷 전송
2. NAT 라우터가 패킷 헤더 변경:
   출발지: 192.168.1.10:1234 → 203.241.132.5:5678
   목적지: 8.8.8.8:53 (변경 없음)
3. NAT 테이블에 변환 정보 저장
4. 변경된 패킷을 인터넷으로 전송
```

**inbound 통신 (외부 → 내부):**

```
1. Google(8.8.8.8:53) → NAT라우터(203.241.132.5:5678) 응답
2. NAT 라우터가 테이블 조회하여 헤더 변경:
   출발지: 8.8.8.8:53 (변경 없음)
   목적지: 203.241.132.5:5678 → 192.168.1.10:1234
3. 변경된 패킷을 내부 네트워크로 전송
```

### NAT 테이블

```
┌─────────────────┬──────────────────┬─────────────────┐
│    내부 주소     │     외부 주소      │      상태       │
├─────────────────┼──────────────────┼─────────────────┤
│192.168.1.10:1234│203.241.132.5:5678│   ESTABLISHED   │
│192.168.1.20:4567│203.241.132.5:5679│   ESTABLISHED   │
│192.168.1.30:8901│203.241.132.5:5680│   TIME_WAIT     │
└─────────────────┴──────────────────┴─────────────────┘
```

### NAT의 장점

**1. IP 주소 절약**

- 하나의 공인 IP로 여러 장치 인터넷 접속
- IPv4 주소 고갈 문제 완화

**2. 보안 강화**

- 내부 네트워크 구조 은닉
- 외부에서 직접 접근 차단
- 방화벽 효과

**3. 네트워크 관리 편의성**

- 내부 주소 체계 자유롭게 설계
- ISP 변경 시에도 내부 네트워크 영향 없음

### NAT의 단점

**1. 성능 오버헤드**

- 모든 패킷의 헤더 변경 필요
- NAT 테이블 관리 부담

**2. 일부 프로토콜 호환성 문제**

- FTP, SIP, H.323 등에서 문제 발생
- End-to-End 연결성 제한

**3. 서버 운영의 복잡성**

- 포트 포워딩 설정 필요
- 외부에서 내부 서버 접근 시 추가 설정

## 5. 실무 활용 사례

### 가정/소호 네트워크

```
인터넷 --- [공유기/NAT] --- 내부 네트워크
            203.241.132.5    192.168.1.0/24
                             ├─ PC: 192.168.1.10
                             ├─ 스마트폰: 192.168.1.20
                             └─ IoT 기기: 192.168.1.30

하나의 공인 IP로 여러 장치 동시 인터넷 사용
```

### 기업 네트워크

```
인터넷 --- [방화벽/NAT] --- DMZ (공인 IP 할당)
            공인 IP 대역      ├─ 웹 서버
                             └─ 메일 서버
                           내부 네트워크 (사설 IP)
                             ├─ 직원 PC들
                             └─ 내부 서버들
```
