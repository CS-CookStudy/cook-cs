# 1. TCP (Transmission Control Protocol)

## 1-0. TCP 란?

- **연결 지향적 프로토콜** : 데이터 **전송 전**에 연결을 설정
- **신뢰성 보장** : 데이터 손실 없이 **순서대로** 전달
- **전이중 통신** : **양방향** 동시 통신 가능
- **흐름 제어 및 혼잡 제어** 지원

## 1-1. TCP 헤더 구조와 흐름 제어

```
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Source Port          |       Destination Port        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Sequence Number                        |  ← 데이터 순서 관리
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Acknowledgment Number                    |  ← 다음 기대 번호
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Data |           |U|A|P|R|S|F|                               |
| Offset| Reserved  |R|C|S|S|Y|I|         Window Size           |  ← 흐름 제어 핵심!
|       |           |G|K|H|T|N|N|                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Checksum            |         Urgent Pointer        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

### 흐름 제어 동작 과정

```
시간 순서대로 TCP 세그먼트 교환:

송신자                           수신자
  |                               |
  |  Seq=1000, Len=500, Win=8192  |  1. 데이터 전송
  |------------------------------>|
  |                               |  수신 버퍼: [1000-1499] 저장
  |                               |  남은 공간: 7692 바이트
  |                               |
  |       ACK=1500, Win=7692      |  2. 확인응답 + 윈도우 크기
  |<------------------------------|
  |                               |
  |  Seq=1500, Len=2000, Win=8192 |  3. 더 큰 데이터 전송
  |------------------------------>|
  |                               |  수신 버퍼: [1000-3499] 저장
  |                               |  남은 공간: 5692 바이트
  |                               |
  |       ACK=3500, Win=5692      |  4. 확인응답 + 줄어든 윈도우
  |<------------------------------|
```

-> 윈도우 **크기의 상황**에 따라서 송신자에게 신호를 달리 보냄 <br>
-> 윈도우 크기가 0인 경우 **전송 중단**, **주기적**으로 수신자에게 확인 후 **버퍼 공간**이 확보가 되면 **전송 재개**

### 주요 필드 설명

- `시퀀스 번호 (Sequence Number)` : **데이터의 순서** 보장
- `확인응답 번호 (Acknowledgment Number)` : **다음에 받을 데이터**의 시퀀스 번호
- `윈도우 크기 (Window Size)` : **흐름 제어**의 핵심, **송신 속도**를 조절
- `플래그 (Flag)` : SYN(연결 설정), ACK(확인응답), FIN(연결 종료) 등등

## 1-2. 3-way Handshake / 4-way Handshake

### 3-way Handshake (연결 설정)

```
클라이언트                    서버
    |                        |
    |--------- SYN --------->|  1. 연결 요청
    |                        |
    |<------ SYN + ACK ------|  2. 연결 승인 + 확인
    |                        |
    |--------- ACK --------->|  3. 확인 응답
    |                        |
    |    연결 성공적으로 수립   |
```

#### 단계별 설명:

1. `SYN` : 클라이언트가 서버에 연결 요청
2. `SYN + ACK` : 서버가 연결 승인 + 확인
3. `ACK` : 클라이언트가 최종 확인

### 4-way Handshake (연결 종료)

```
클라이언트                    서버
    |                        |
    |--------- FIN --------->|  1. 연결 종료 요청
    |                        |
    |<-------- ACK ----------|  2. 종료 요청 확인
    |                        |
    |<-------- FIN ----------|  3. 서버도 종료 요청
    |                        |
    |--------- ACK --------->|  4. 최종 확인
    |                        |
    |      연결 완전 종료      |
```

#### 단계별 설명:

1. `FIN` : **클라이언트**가 서버에 **연결 종료** 요청
2. `ACK` : **서버**가 **종료 요청 확인** (아직 데이터 전송 가능)
3. `FIN` : **서버**도 **연결 종료** 요청
4. `ACK` : 클라이언트가 최종 확인 후 **연결 완전 종료**

## 1-3. 흐름 제어 (Flow Control)

### 목적

- **송신의 전송 속도 조절** : 수신자가 처리할 수 있는 속도로 전송
- **버퍼 오버플로우 방지** : 수신 버퍼가 넘치지 않도록 제어

### 슬라이딩 윈도우 (Sliding Window)

```
송신 버퍼: [1][2][3][4][5][6][7][8][9][10]
              ↑     ↑           ↑
            송신완료  송신대기    윈도우끝

수신 버퍼: [1][2][3][ ][ ][ ][ ][ ][ ][ ]
              ↑     ↑           ↑
            수신완료  기대번호    윈도우끝
```

#### 동작 원리:

- **수신자**가 **윈도우 크기**를 송신자에게 알림
- **송신자**는 윈도우 **크기만큼**만 **연속 전송**
- **확인응답**을 받으면 **윈도우를 오른쪽**으로 이동

## 1-4. 혼잡 제어 (Congestion Control)

### 목적

- **네트워크 혼잡 방지** : 네트워크 용량 초과 시 전송 속도 조절
- **공정한 대역폭 분배** : 모든 연결이 공평하게 네트워크 사용

### 주요 알고리즘

#### 1. 슬로우 스타트 (Slow Start)

```
혼잡 윈도우 크기 변화:
1 → 2 → 4 → 8 → 16 → 32 ...
```

- 처음에는 지수적으로 증가
- 임계점에 도달하면 선형 증가로 전환 됨

#### 2. 혼잡 회피 (Congestion Avoidance)

- 임계점 이후 선형적으로 증가 (1씩 증가)
- 패킷 손실 감지 시 윈도우 크기 감소

#### 3. 빠른 재전송 (Fast Retransmit)

- 3개의 중복 ACK 받으면 즉시 재전송
- 타임아웃을 기다리지 않고 빠르게 복구

#### 4. 빠른 복구 (Fast Recovery)

- 빠른 재전송 후 윈도우 크기를 절반으로 줄임
- 슬로우 스타트 단계를 건너뛰고 혼잡 회피 단계로

## 1-5. 오류 제어와 재전송 기법

### ARQ (Automatic Repeat Request)

**자동 반복 요청**으로 **데이터 전송**에서 **오류를 검출**하고 **수정**하기 위해 사용되는 오류 제어 방식

#### 1. Stop-and-Wait ARQ

```
송신자       수신자
 |    Data    |
 |----------->|
 |            |
 |     ACK    |
 |<-----------|
 |  Next Data |
 |----------->|
```

- **"하나 보내고 → 확인 받고 → 다음 보내고"** 의 반복

#### 2. Go-Back-N ARQ

- 윈도우 크기만큼 연속 전송
- 오류 발생 시 해당 프레임부터 **모두 재전송**

#### 3. Selective Repeat ARQ

- **오류 발생한 프레임**만 **선택적** 재전송
- 가장 효율적이지만 복잡한 구현

<br>

# 2. UDP (User Datagram Protocol)

## 2-0. UDP 란?

- **비연결형 프로토콜** : 연결 설정 없이 바로 전송
- **신뢰성 없음** : 데이터 손실, 순서 바뀜 가능
- **빠른 전송** : 오버헤드 최소화
- **간단한 구조** : 헤더가 매우 단순

## 2-1. UDP 헤더 구조

```
0      7 8     15 16    23 24    31
+--------+--------+--------+--------+
|     Source      |   Destination   |
|      Port       |      Port       |
+--------+--------+--------+--------+
|     Length      |    Checksum     |
+--------+--------+--------+--------+
|               Data                |
+-----------------------------------+
```

#### 헤더 크기 : 단 8바이트 (TCP는 20바이트)

## 2-2. UDP 사용 사례

- **DNS 질의** : 빠른 응답 필요
- **스트리밍** : 실시간성 중요, 일부 손실 허용
- **온라인 게임** : 낮은 지연시간 필요
- **DHCP** : 간단한 요청 - 응답

<br>

# 3. TCP vs UDP 비교

| 특성          | TCP           | UDP         |
| ------------- | ------------- | ----------- |
| **연결 방식** | 연결 지향     | 비연결 지향 |
| **신뢰성**    | 보장          | 보장 안함   |
| **순서 보장** | 보장          | 보장 안함   |
| **오류 검출** | 있음          | 체크섬만    |
| **흐름 제어** | 있음          | 없음        |
| **혼잡 제어** | 있음          | 없음        |
| **헤더 크기** | 20바이트 이상 | 8바이트     |
| **전송 속도** | 느림          | 빠름        |
| **오버헤드**  | 높음          | 낮음        |

## 3-1. 선택 기준

#### TCP 선택 시:

- 데이터 정확성이 중요한 경우 (파일 전송, 웹 브라우징)
- 신뢰성 있는 통신이 필요한 경우

#### UDP 선택 시:

- 실시간성이 중요한 경우 (스트리밍, 게임)
- 간단한 요청-응답 통신 (DNS)
- 브로드캐스트/멀티캐스트 통신

<br>

# 4. 포트 번호와 소켓

## 4-1. 포트 번호 (Port Number)

- **16비트 숫자** (0 ~ 65535)
- 같은 컴퓨터 내에서 **프로세스 식별**
- IP 주소 + 포트 번호 = **소켓 주소**

### 포트 번호 분류

| 범위          | 이름            | 용도          |
| ------------- | --------------- | ------------- |
| 0 ~ 1023      | Well-known Port | 시스템 서비스 |
| 1024 ~ 49151  | Registered Port | 응용 프로그램 |
| 49152 ~ 65535 | Dynamic Port    | 임시 포트     |

### 주요 Well-known Port

- `HTTP`: 80
- `HTTPS`: 443
- `FTP`: 21
- `SSH`: 22
- `Telnet`: 23
- `SMTP`: 25
- `DNS`: 53
- `POP3`: 110
- `IMAP`: 143

## 4-2. 소켓 (Socket)

- 정의 : **IP 주소** + **포트 번호**
- 예시 : 192.168.1.100:8080
- 역할 : 네트워크 통신의 끝점 (endpoint)

```
클라이언트 소켓: 192.168.1.100:12345
     ↓
서버 소켓: 192.168.1.200:80
```
