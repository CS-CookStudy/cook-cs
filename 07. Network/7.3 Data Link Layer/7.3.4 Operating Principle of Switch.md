# 스위치의 동작 원리

## 1. 스위치 기본 개념

### 스위치란?

- **데이터 링크 계층(Layer 2)에서 동작하는 네트워크 장비**
- **MAC 주소를 기반으로 프레임을 지능적으로 전달**
- 허브와 달리 각 포트가 독립된 충돌 도메인을 형성해 성능 향상

### 허브 vs 스위치 비교

```
허브 (Hub):
- 물리 계층 장비 (단순 신호 증폭)
- 모든 포트에 데이터 전송 (브로드캐스트)
- 대역폭을 모든 포트가 공유
- 충돌 발생 가능

스위치 (Switch):
- 데이터링크 계층 장비 (프레임 분석)
- 목적지 포트에만 전송 (유니캐스트)
- 각 포트가 전용 대역폭 사용
- 충돌 없음 (전이중 통신)
```

## 2. 스위치 핵심 동작 원리

### 3가지 기본 기능

**1. 학습 (Learning)**

- 수신된 프레임의 **출발지 MAC 주소**를 자동으로 학습
- 해당 MAC 주소가 어느 포트에 연결되어 있는지 기억
- 이를 통해 네트워크 토폴로지를 자동으로 파악

**2. 전달 (Forwarding)**

- 목적지 MAC 주소를 MAC 테이블에서 검색
- **해당 포트로만 프레임 전송** (불필요한 트래픽 제거)
- 네트워크 효율성 크게 향상

**3. 플러딩 (Flooding)**

- 목적지 MAC 주소를 모르는 경우 **모든 포트에 전송**
- 브로드캐스트(FF:FF:FF:FF:FF:FF) 프레임도 모든 포트로 전송
- 일종의 "안전장치" 역할

### MAC 주소 테이블 (CAM Table)

```
┌───────────────────┬──────────┬─────────┐
│     MAC 주소       │ 포트번호  │   TTL   │
├───────────────────┼──────────┼─────────┤
│ AA:BB:CC:DD:EE:FF │    1     │  300초  │
│ 11:22:33:44:55:66 │    2     │  250초  │
└───────────────────┴──────────┴─────────┘
```

**특징:**

- **동적 학습**: 프레임을 받을 때마다 자동으로 업데이트
- **에이징 타이머**: 보통 300초 후 자동 삭제 (메모리 효율성)
- **하드웨어 기반**: 고속 검색을 위해 TCAM/CAM 사용

## 3. 동작 과정 실제 예시

### 상황: PC-A가 PC-B에게 데이터 전송

```
┌─────┐ 포트1  ┌────────┐ 포트2 ┌─────┐
│PC-A │───────│ Switch │───────│PC-B │
└─────┘       └────────┘       └─────┘
MAC: AA:AA     (빈 테이블)     MAC: BB:BB
```

**1단계: A → B 첫 번째 프레임 전송**

- PC-A가 "출발지: AA:AA, 목적지: BB:BB" 프레임 전송
- 스위치는 포트1에서 MAC AA:AA를 학습하여 테이블에 저장
- 목적지 BB:BB를 모르므로 **모든 포트로 플러딩** (포트2로 전달)
- MAC 테이블: {AA:AA → 포트1}

**2단계: B → A 응답 프레임**

- PC-B가 "출발지: BB:BB, 목적지: AA:AA" 응답 전송
- 스위치는 포트2에서 MAC BB:BB를 학습
- 목적지 AA:AA는 이미 포트1에 있다는 것을 알고 있음
- **포트1로만 정확히 전송** (효율적인 유니캐스트)
- MAC 테이블: {AA:AA → 포트1, BB:BB → 포트2}

**3단계: 이후 모든 통신**

- 양방향 MAC 주소를 모두 학습 완료
- 앞으로 A↔B 통신은 항상 정확한 포트로만 전송
- 다른 포트는 이 트래픽에 전혀 영향받지 않음

## 4. 프레임 전달 방식

**Store-and-Forward (저장 후 전달)**

- 전체 프레임을 완전히 수신 → 오류 검사 → 전달
- **장점**: 잘못된 프레임 차단, 안정성 높음
- **단점**: 지연 시간 발생 (보통 수십 마이크로초)

**Cut-Through (즉시 전달)**

- 목적지 MAC 주소만 확인되면 즉시 전달 시작
- **장점**: 매우 낮은 지연 시간
- **단점**: 오류가 있는 프레임도 전달될 수 있음

대부분의 현대 스위치는 **Store-and-Forward** 방식을 사용합니다.

## 5. 스위치의 주요 장점

### 성능 향상

- **충돌 도메인 분리**: 각 포트가 독립적이므로 충돌 없음
- **전이중 통신**: 송신과 수신을 동시에 수행 가능
- **전용 대역폭**: 각 포트가 전체 대역폭을 독점 사용

### 지능적 트래픽 관리

- **자동 학습**: 별도 설정 없이도 네트워크 구조 파악
- **선택적 전달**: 필요한 곳에만 데이터 전송 (보안성 향상)
- **브로드캐스트 제어**: 같은 브로드캐스트 도메인 내에서만 전파

### 확장성과 유지보수

- **플러그 앤 플레이**: 새 장치 연결 시 자동으로 학습
- **루프 감지**: STP 등의 프로토콜로 네트워크 루프 방지
- **포트별 관리**: 개별 포트 상태 모니터링 가능

## 6. 브로드캐스트와 멀티캐스트 처리

### 브로드캐스트 프레임

- 목적지가 **FF:FF:FF:FF:FF:FF**인 프레임
- 항상 모든 포트로 전송 (수신 포트 제외)
- ARP 요청, DHCP 등에서 사용

### 멀티캐스트 프레임

- 특정 그룹을 대상으로 하는 프레임
- 기본적으로 모든 포트로 플러딩
- IGMP Snooping 등으로 최적화 가능
