# VLAN (Virtual LAN)

## 1. VLAN 기본 개념

### VLAN이란?

- **Virtual LAN**: 물리적 네트워크를 논리적으로 분할하는 기술
- **IEEE 802.1Q 표준**에서 정의
- 하나의 물리적 스위치를 여러 개의 가상 스위치처럼 동작시킴
- **브로드캐스트 도메인을 논리적으로 분리**하는 핵심 기술

### VLAN이 필요한 이유

**기존 문제점:**

```
물리적 네트워크만 사용하는 경우:
- 부서별 분리를 위해 별도 스위치 필요
- 브로드캐스트 트래픽이 전체 네트워크로 전파
- 보안성 부족 (모든 장치가 같은 네트워크)
- 유연성 부족 (물리적 이동 시 재설정 필요)
```

**VLAN 해결책:**

- **논리적 분할**: 하나의 스위치로 여러 네트워크 구성
- **브로드캐스트 제어**: VLAN별로 브로드캐스트 도메인 분리
- **보안 강화**: VLAN 간 통신 제어 가능
- **유연성 향상**: 포트 설정만으로 네트워크 변경

## 2. VLAN 동작 원리

### VLAN 태그 (802.1Q Tag)

**이더넷 프레임에 VLAN 정보 추가:**

```
기존 이더넷 프레임:
┌──────────┬──────────┬────────┬──────────┬─────┐
│  목적지   │  출발지   │길이/타입│  데이터   │ FCS │
│ MAC(6B)  │ MAC(6B)  │  (2B)  │          │(4B) │
└──────────┴──────────┴────────┴──────────┴─────┘

802.1Q 태그가 추가된 프레임:
┌──────────┬──────────┬─────────┬────────┬──────────┬─────┐
│  목적지   │  출발지   │ VLAN태그 │길이/타입│   데이터  │ FCS │
│  MAC(6B) │ MAC(6B)  │  (4B)   │ (2B)   │          │(4B) │
└──────────┴──────────┴─────────┴────────┴──────────┴─────┘
```

**VLAN 태그 구조 (4바이트):**

```
┌─────────────┬───┬─────┬─────────────┐
│    TPID     │PCP│ CFI │    VID      │
│   (16비트)   │(3)│ (1) │  (12비트)   │
└─────────────┴───┴─────┴─────────────┘

- TPID: 0x8100 (VLAN 태그 식별자)
- PCP: 우선순위 (QoS용)
- CFI: 정규 형식 지시자
- VID: VLAN ID (1~4094)
```

### VLAN ID 범위

- **유효 범위**: 1 ~ 4094 (총 4093개)
- **예약된 값**:
  - 0: 우선순위만 태그
  - 4095: 예약됨
- **일반적 사용**: 1~1000 (관리 편의성)

## 3. VLAN 포트 타입

### Access 포트

- **단일 VLAN에만 속함**
- 일반적으로 엔드 디바이스(PC, 서버) 연결용
- **태그 없는 프레임** 송수신
- 스위치가 자동으로 VLAN 태그 추가/제거

```
PC ──────── Access 포트 (VLAN 10)
(태그 없음)     │
               └→ 스위치가 VLAN 10 태그 추가
```

### Trunk 포트

- **여러 VLAN 트래픽을 동시에 전달**
- 스위치 간 연결이나 라우터 연결용
- **태그가 있는 프레임** 송수신
- 여러 VLAN을 하나의 물리적 링크로 전송

```
스위치A ──── Trunk 포트 ──── 스위치B
         (VLAN 10,20,30 혼재)
```

### Native VLAN

- Trunk 포트에서 **태그 없이 전송되는 VLAN**
- 기본값: VLAN 1
- 보안상 변경 권장 (VLAN hopping 공격 방지)

## 4. VLAN 구성 예시

### 시나리오: 회사 네트워크 분할

**요구사항:**

- 인사팀, 개발팀, 영업팀을 별도 네트워크로 분리
- 각 팀의 브로드캐스트 트래픽 격리
- 보안 정책 적용

**물리적 구성:**

```
┌────────┐    ┌────────┐    ┌────────┐
│ 인사PC  │    │ 개발PC │    │  영업PC │
└───┬────┘    └───┬────┘    └───┬────┘
    │포트1         │포트2        │포트3
    └─────────┬───┴─────────────┘
              │
         ┌──────────┐
         │  Switch  │
         └──────────┘
```

**VLAN 설정:**

```
포트1: Access VLAN 10 (인사팀)
포트2: Access VLAN 20 (개발팀)
포트3: Access VLAN 30 (영업팀)
```

**결과:**

- 각 팀은 논리적으로 분리된 네트워크
- 팀 내부 통신만 가능
- 브로드캐스트는 같은 VLAN 내에서만 전파

## 5. 멀티 스위치 VLAN 구성

### Trunk 링크 활용

**시나리오: 2개 스위치에 걸친 VLAN**

```
스위치A                          스위치B
┌─────────┐                     ┌─────────┐
│포트1(V10)│                     │포트1(V10)│
│포트2(V20)│  Trunk(V10,20,30)   │포트2(V20)│
│포트3(V30)│◄──────────────────► │포트3(V30)│
└─────────┘                     └─────────┘
```

**동작 방식:**

1. 스위치A의 VLAN 10 장치가 프레임 전송
2. 스위치A가 프레임에 VLAN 10 태그 추가
3. Trunk 링크로 태그된 프레임 전송
4. 스위치B가 VLAN 10 태그 확인 후 해당 포트로만 전달

**장점:**

- 물리적 위치와 관계없이 같은 VLAN 구성
- 유연한 네트워크 확장
- 케이블 절약 (하나의 Trunk로 여러 VLAN 전송)

## 6. VLAN 간 통신

### 기본 원칙

- **같은 VLAN 내**: 직접 통신 가능 (스위치 레벨)
- **다른 VLAN 간**: 라우터 필요 (Layer 3 장비)

### Inter-VLAN 라우팅

**Router-on-a-Stick 방식:**

```
┌─────────┐
│ Router  │
└────┬────┘
     │ Trunk (VLAN 10,20)
┌────┴────┐
│ Switch  │
├─────────┤
│ VLAN 10 │ ← PC-A
│ VLAN 20 │ ← PC-B
└─────────┘
```

**동작 과정:**

1. PC-A(VLAN 10)가 PC-B(VLAN 20)와 통신 시도
2. 스위치가 다른 VLAN임을 인식 → 라우터로 전송
3. 라우터가 VLAN 간 라우팅 수행
4. 목적지 VLAN으로 프레임 전달
