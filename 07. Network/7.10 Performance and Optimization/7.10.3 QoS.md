# 7.10 성능과 최적화

# QoS (Quality of Service)
> `서비스 품질`
> 네트워크에서 **특정 트래픽에 우선순위를 부여하거나**,
>
> **지연이나 손실을 제어**하여 **사용자에게 일정 수준 이상의 성능을 보장**하는 기술

- 중요한 데이터는 빠르고 안정적으로, 덜 중요한 데이터는 나중에 처리하도록 하는 기술

### 왜 필요한가?

* 모든 트래픽이 동일하게 처리되면 지연에 민감한 서비스(VoIP, 영상회의, 게임)가 영향을 받음
  - 높은 트래픽을 동시에 사용하면 네트워크 혼잡 발생
* 네트워크 자원은 제한되어 있으므로 **중요 트래픽에 우선순위를 줄 필요**가 있음

---

## QoS의 주요 지표

 | 지표                       | 설명                                   |
| ------------------------ | ------------------------------------ |
| **대역폭 (Bandwidth)**      | 트래픽이 사용할 수 있는 최대 전송 용량               |
| **지연 (Delay / Latency)** | 패킷이 목적지까지 도달하는 시간                    |
| **지터 (Jitter)**          | 패킷 간 전송 시간의 편차 (→ 영상/음성에서 매우 중요)     |
| **패킷 손실률 (Packet Loss)** | 도중에 손실된 패킷의 비율 (→ TCP 재전송, 품질 저하 원인) |


## QoS 주요 기능

1. **대역폭(Bandwidth) 관리**
  - 중요한 서비스에 더 많은 대역폭을 배정.

2. **우선순위(Priority) 관리**
  - 중요한 트래픽이 먼저 처리되도록 함.

3. **지연(Latency) 및 지터(Jitter) 관리**
  - 네트워크 지연이나 불규칙한 전송 속도 변화를 최소화.

4. **패킷 손실(Packet loss) 관리**
  - 중요한 데이터 패킷의 손실을 방지.
---

## QoS 적용 대상 예시

| 서비스 유형         | QoS 필요성                      |
| -------------- | ---------------------------- |
| **VoIP**       | 낮은 지연, 낮은 지터, 패킷 손실 최소화 필요   |
| **영상 스트리밍**    | 대역폭 확보 + 지연 완화               |
| **파일 전송(FTP)** | 지연보다 **신뢰성**이 중요 (QoS 비중 낮음) |
| **온라인 게임**     | 낮은 지연 + 일정한 응답 시간 필수         |

---

### QoS 작동 방식 (도식화)

```mermaid
flowchart LR
    A[트래픽 식별] --> B[분류 및 마킹]
    B --> C[우선순위 결정 (큐잉)]
    C --> D[대역폭 예약 / 스케줄링]
    D --> E[혼잡 제어 / 드롭 정책]
```

</br>

---

## QoS 구현 기술

| 기술                                    | 설명                                                                  |
| ------------------------------------- | ------------------------------------------------------------------- |
| **트래픽 분류 (Classification)**           | 트래픽 종류(IP/포트/애플리케이션) 기반으로 식별                                        |
| **마킹 (Marking)**                      | IP 헤더의 DSCP, ToS 필드로 패킷에 우선순위 부여                                    |
| **큐잉 (Queuing)**                      | 트래픽을 **큐(queue)**에 저장 후 우선순위에 따라 전송<br>→ FIFO, PQ, WFQ, CBWFQ 등 |
| **스케줄링**                              | 큐에서 어느 순서로 패킷을 전송할지 결정                                              |
| **혼잡 제어 (Congestion Management)**     | 네트워크 혼잡 시 일부 패킷을 **드롭하거나 지연**시켜 품질 유지 (예: RED, WRED)                |
| **대역폭 할당 (Traffic Shaping/Policing)** | 트래픽 속도를 제한하거나 초과시 드롭                                                |

</br>

### 대표적 QoS 큐잉 알고리즘

| 큐잉 방식                           | 설명                              |
| ------------------------------- | ------------------------------- |
| **FIFO (First-In First-Out)**   | 가장 단순, 순서대로 전송 (QoS 적용 어려움)     |
| **PQ (Priority Queuing)**       | 트래픽 우선순위 지정 → 높은 등급 먼저 처리       |
| **WFQ (Weighted Fair Queuing)** | 트래픽마다 **가중치**를 부여하여 공정하게 분배     |
| **CBWFQ (Class-Based WFQ)**     | 트래픽을 **클래스 기반으로 구분**, 각각 가중치 할당 |

</br>

---

## 실무 활용 예시

| 사례                        | 설명                           |
| ------------------------- | ---------------------------- |
| ISP에서 **VoIP 트래픽 우선 처리**  | 음성 통화 품질 보장                  |
| 기업 내부에서 **업무용 트래픽 우선 처리** | Slack, Zoom 등 필수 앱 우선        |
| 고속도로 CCTV 실시간 송출          | 끊김 없는 영상 송출을 위해 전용 QoS 경로 사용 |
| 병원 PACS 서버 → 진료실 영상 송출    | 진단용 대용량 데이터 우선 보장 필요         |

---

## 8. QoS 구현 계층

* **레이어 2 (Data Link Layer)**

  * VLAN 기반 QoS (802.1p)
* **레이어 3 (Network Layer)**

  * IP 헤더의 DSCP 필드 사용 (DiffServ)
* **애플리케이션 계층**

  * RTP 헤더의 우선순위 플래그 활용 등
