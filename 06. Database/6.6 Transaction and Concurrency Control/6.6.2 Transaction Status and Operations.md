# 6.6 트랜잭션과 동시성 제어
# 6.6.2 트랜잭션 상태와 연산
---

# 트랜잭션 연산
| 연산         | 설명                       |
| ---------- | ------------------------ |
| `BEGIN`    | 트랜잭션의 시작                 |
| `READ(X)`  | 데이터 항목 X를 읽음             |
| `WRITE(X)` | 데이터 항목 X를 변경함            |
| `COMMIT`   | 트랜잭션 성공 종료 → 변경 내용 영구 반영 |
| `ROLLBACK` | 트랜잭션 실패 종료 → 변경 내용 모두 취소 |

## 커밋과 롤백
### 커밋
> 여러 쿼리가 성공적으로 처리되었다고 확정하는 명령어
- 하나의 트랜잭션이 성공적으로 종료된 후, 데이터베이스가 일관된 상태를 유지할 때 갱신 연산이 완료되었다고 관리자에게 알려주고 최종적으로 데이터 베이스에 반영

### 롤백
> 트랜잭션으로 처리한 하나의 묶음 과정을 일어나기 전으로 되돌리는 일(취소)
- 에러나 여러 이슈로 트랜잭션이 비정상적으로 종료되어 데이터베이스 일관성을 잃었을 때, 트랜잭션이 지금까지 실행한 연산의 결과가 취소되고 트랜잭션 수행 이전 상태로 되돌아가는 연산

## 트랜잭션 예시
```sql
BEGIN;
UPDATE account SET balance = balance - 100 WHERE name = 'A';
UPDATE account SET balance = balance + 100 WHERE name = 'B';
COMMIT;
```
- 은행 계좌에서 A -> B로 이체하는 경우
    - 이 도중에 오류가 발생하면 ROLLBACK하여 A의 돈도 다시 복구됨 → 일관성 보장

</br>

# 트랜잭션 상태
```css
[Active] → [Partially Committed] → [Committed]
     ↓               ↓
 [Failed] ←————— [Aborted]
```

</br>

| 상태                      | 설명                               |
| ----------------------- | -------------------------------- |
| **Active**              | 트랜잭션이 실행 중 (연산 수행 중)             |
| **Partially Committed** | 마지막 연산이 완료된 상태. 아직 디스크에는 반영 전    |
| **Committed**           | 모든 연산 성공 → DB에 영구 반영 완료          |
| **Failed**              | 오류나 중단 발생. 정상 종료 불가 상태           |
| **Aborted**             | ROLLBACK 수행 후, DB를 이전 상태로 복구한 상태 |

