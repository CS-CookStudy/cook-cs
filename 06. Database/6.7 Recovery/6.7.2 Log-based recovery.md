# 6.7 회복(Recovery)
# 6.7.2 로그 기반 회복

</br>

# 로그 파일
> 트랜잭션이 반영한 모든 데이터의 변경사항을 데이터베이스에 기록하기 전에 미리 기록해두는 별도의 데이터베이스
- 안전한 하드디스크에 저장되며 전원과 관계없이 기록이 존재
- 로그의 구조: <트랜잭션 번호, 로그의 타입, 데이터 항목 이름, 수정 전 값, 수정 후 값>
- 로그의 타입: START, INSERT, UPDATE, DELETE, ABORT, COMMIT 등 트랜잭션의 연산 타입

---

# 로그 회복 기법 : 즉시 갱신, 지연(연기) 갱신
> 트랜잭션의 변경 내용을 Undo/Redo 로그에 기록해 두었다가, 장애 발생 시 로그를 기반으로 복구 작업을 수행


## 1️⃣ 즉시 갱신 기법(Immediate Update)
> 트랜잭션이 데이터를 갱신하면 트랜잭션이 **부분 완료되기 전이라도 즉시 실제 데이터베이스에 반영**하는 방법
- 장애가 발생하여 회복 작업할 경우를 대비하여 갱신된 내용들을 Log에 보관
- Redo와 Undo 모두 사용 가능

## 2️⃣ 지연 갱신 기법 (Deferred Update)
> 트랜잭션이 성공적으로 **완료될 때까지** 데이터베이스에 대한 실질적인 갱신을 연기하는 방법
- 트랜잭션이 수행되는 동안 갱신된 내용은 일단 Log에 보관됨
- 트랜잭션의 부분 완료 시점에 Log에 보관한 갱신 내용을 실제 데이터베이스에 기록함
- **Redo** 작업만 가능

</br>

> **❗Redo와 Undo**
>
> **Undo**: 트랜잭션 로그에 보관한 정보를 이용하여 **가장 최근에 변경된 내용부터** 거슬러 올라가면서 트랜잭션 작업을 취소하여 원래의 데이터베이스로 복구.
>
> **Redo**: 트랜잭션 로그와 덤프를 이용하여 가장 최근의 정상적인 데이터베이스로 회복시킨 후 트랜잭션을 재실행.
>   - 덤프(dump) : 주기적으로 데이터베이스 전체를 다른 저장 장치에 복사해 두는 것
>
>   - 로그 : 갱신되기 전후의 내용을 기록하는 별도의 파일

</br>

---
# 로그 기반 회복 장단점
### 장점
- 가장 널리 사용되는 표준 기법 (PostgreSQL, InnoDB 등)
- 복구 가능 범위가 넓음 (시스템, 트랜잭션 장애 대응)
- 지연 갱신 / 즉시 갱신 등 다양한 전략과 호환

### 단점
- 로그 처리로 인한 디스크 I/O 부담
- 장애 발생 시 복구 시간이 로그 양에 비례하여 증가
- 지속적으로 로그를 기록해야 하므로 부하 발생