# 6.7 회복(Recovery)
# 6.7.3 그림자 페이징

</br>

# 그림자 페이지 대체 기법(Shawdow Paging)
> **데이터를 직접 덮어쓰지 않고**,
>
> 새로운 페이지(복사본, Shadow Page)를 만들어 수정한 뒤,
>
> 트랜잭션이 성공하면 페이지 테이블을 새로운 페이지로 교체하는 방식.

- 트랜잭션이 완전히 끝나기 전까지는 **원본 데이터는 건드리지 않고** 성공한 경우에만 포인터(페이지 테이블)를 변경하여 적용
- 갱신 이전의 데이터베이스를 **일정 크기의 페이지 단위로** 구성하여 각 페이지마다 복사본인 **그림자 페이지**를 별도 보관
- 그림자 페이지에서 실제 페이지를 대상으로 갱신 작업을 수행하다 장애가 발생하면, 트랜잭션 작업을 Rollback시킬 때는 **갱신 이후의 실제 페이지 부분을 그림자 페이지로** 대체하여 회복

- 현재 테이블은 주기억장치, 그림자 테이블은 디스크에 저장
- 트랜잭션이 성공적으로 수행되는 경우 그림자 페이지 테이블을 삭제하고, 실패할 경우 그림자 페이지 테이블을 통해 복구

## 동작 순서
### 트랜잭션 실행 전
시스템은 **그림자 페이지 테이블(복사본)**을 만들어 유지

### 트랜잭션 수행 중
- 데이터 변경 시 기존 페이지를 덮어쓰지 않고 새로운 페이지를 할당하고 그쪽에 변경 내용 기록
- 현재 페이지 테이블에서 새 페이지로 포인터 변경

### 트랜잭션 종료 시
- **트랜잭션이 성공(COMMIT)하면** : 그림자 테이블 → 현재 페이지 테이블로 교체
- **실패(ROLLBACK) 시** : 현재 테이블을 버리고, 그림자 테이블로 복원

</br>

---
# 그림자 페이지 대체 기법 장단점
### 장점
- Undo/Redo 로그가 필요 없음
- 복구가 매우 빠름 (그림자 페이지 참조만 되돌리면 됨)
- 변경 중단 없이 원본 데이터 항상 유지

### 단점
- 페이지 단위 복사 → 디스크 공간 낭비 많음
- 트랜잭션 병행성 지원 어려움
- 현대 DB의 동적 트랜잭션 처리에 부적합
- 대규모 시스템에는 비효율적
- 여러 버전의 페이지가 존재하므로 버퍼 관리 복잡

</br>

---
# 회복 기법 비교 요약표
| 항목           | 로그 기반 회복         | 체크포인트         | 그림자 페이지       |
| ------------ | ---------------- | ------------- | ------------- |
| **복구 속도**    | 중간 (로그 양에 비례)    | 빠름 (범위 축소)    | 매우 빠름         |
| **로그 필요 여부** | O (Undo/Redo)    | O (로그 기반이 전제) | ❌ 불필요         |
| **복구 전략**    | Undo/Redo 수행     | 복구 시작점 최적화    | 페이지 매핑 되돌리기   |
| **디스크 사용량**  | 적절함              | 보조적           | 큼 (전체 복사 필요)  |
| **병행성 지원**   | 우수               | 보조적           | 매우 어렵거나 불가    |
| **실무 사용**    | ✅ 대부분 DBMS 사용    | ✅ 보편적으로 함께 사용 | ❌ 실무에선 거의 안 씀 |
| **장점 요약**    | 유연하고 강력          | 복구 시간 절약      | 복구 매우 빠름      |
| **단점 요약**    | 로그 I/O 비용, 복구 복잡 | 오버헤드 존재       | 확장성/공간 낭비 심함  |
