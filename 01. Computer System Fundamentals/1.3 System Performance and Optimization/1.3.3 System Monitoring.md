## 3. 시스템 모니터링 기법 (System Monitoring)

- **정의**: 시스템 자원의 상태와 성능을 주기적으로 관찰하고 분석하여, 장애 예방과 성능 개선, 안정적인 운영을 도모하는 기법

---

## ○ 시스템 모니터링의 필요성

- **장애 예방**: 사전에 문제를 감지하고 대응하여 서비스 중단 최소화
- **성능 최적화**: 시스템 병목 구간 식별 및 개선을 통한 성능 향상
- **SLA 준수**: 서비스 수준 협약(Service Level Agreement) 달성 및 유지
- **비용 최적화**: 리소스 낭비 방지 및 효율적인 자원 활용
- **용량 계획**: 트래픽 증가에 대비한 인프라 확장 계획 수립

---

## ○ Observability의 3 Pillars

### 📊 **메트릭(Metrics)**

- **정의**: 시스템의 수치적 측정값
- **특징**: 시계열 데이터, 집계 및 알림에 적합
- **예시**: CPU 사용률, 메모리 사용량, 응답시간

### 📝 **로그(Logs)**

- **정의**: 시스템에서 발생하는 이벤트의 기록
- **특징**: 상세한 컨텍스트 정보 제공
- **예시**: 에러 로그, 접근 로그, 트랜잭션 로그

### 🔍 **트레이스(Traces)**

- **정의**: 요청이 시스템을 통과하는 경로 추적
- **특징**: 분산 시스템에서 요청 흐름 파악
- **예시**: 마이크로서비스 간 호출 추적

---

## ○ 모니터링 대상 및 임계값

### 🖥️ **하드웨어 자원**

#### CPU 사용률

- **정상**: 0-70%
- **주의**: 70-85%
- **위험**: 85% 이상
- **알림 기준**: 80% 이상이 5분간 지속

#### 메모리 사용량

- **정상**: 0-75%
- **주의**: 75-90%
- **위험**: 90% 이상
- **알림 기준**: 85% 이상이 3분간 지속

#### 디스크 사용률

- **정상**: 0-80%
- **주의**: 80-90%
- **위험**: 90% 이상
- **알림 기준**: 85% 이상

#### 디스크 I/O

- **측정 지표**: IOPS, Read/Write 속도, Queue Length
- **알림 기준**: Queue Length > 10 지속

#### 네트워크 트래픽

- **측정 지표**: 대역폭 사용률, 패킷 손실률, 지연시간
- **알림 기준**: 대역폭 90% 이상 또는 패킷 손실 1% 이상

### 🌐 **애플리케이션 상태**

#### 응답 시간

- **목표**: 웹페이지 3초 이하, API 1초 이하
- **알림 기준**: 평균 응답시간이 목표값의 150% 초과

#### 에러율

- **목표**: 0.1% 이하 (99.9% 성공률)
- **알림 기준**: 1% 이상 또는 5분간 0.5% 이상

#### 처리량 (TPS)

- **측정**: 초당 트랜잭션 수
- **알림 기준**: 평상시 대비 50% 이하로 감소

#### 동시 접속자 수

- **모니터링**: 활성 세션/커넥션 수
- **알림 기준**: 최대 처리 가능 수의 80% 도달

### 📋 **시스템 로그**

- **시스템 로그**: syslog, kernel log
- **애플리케이션 로그**: 비즈니스 로직 에러, 성능 지표
- **보안 로그**: 인증 실패, 비정상 접근 시도

---

## ○ 4 Golden Signals (구글 SRE 핵심 지표)

### 1. **지연시간 (Latency)**

- 요청 처리에 걸리는 시간
- 성공/실패 요청을 구분하여 측정

### 2. **트래픽 (Traffic)**

- 시스템에 대한 요구량
- 웹서비스: 초당 HTTP 요청 수

### 3. **에러 (Errors)**

- 실패한 요청의 비율
- 명시적 실패(5xx)와 암시적 실패(잘못된 콘텐츠) 포함

### 4. **포화도 (Saturation)**

- 시스템 리소스의 사용 정도
- 대기열 길이, 메모리 사용률 등

---

## ○ 모니터링 방식

### 1. **에이전트 기반 모니터링**

- **방식**: 서버에 에이전트를 설치하여 데이터 수집
- **장점**:
  - 세밀하고 정확한 모니터링 가능
  - 커스텀 메트릭 수집 가능
  - 실시간 데이터 수집
- **단점**:
  - 에이전트 설치 및 유지관리 필요
  - 시스템 리소스 사용
- **예시**: Datadog Agent, New Relic Agent

### 2. **에이전트리스 모니터링**

- **방식**: SNMP, WMI, SSH, API 등을 활용해 외부에서 수집
- **장점**:
  - 설치 부담 없음
  - 시스템 영향 최소화
- **단점**:
  - 제한된 정보만 수집 가능
  - 네트워크 의존성
- **예시**: SNMP 기반 네트워크 장비 모니터링

### 3. **데이터 수집 방식**

#### 푸시(Push) 방식

- **방식**: 대상 시스템이 주기적으로 모니터링 서버에 데이터 전송
- **장점**: 실시간성, 확장성
- **단점**: 네트워크 장애 시 데이터 손실 가능
- **예시**: StatsD, InfluxDB

#### 풀(Pull) 방식

- **방식**: 모니터링 서버가 주기적으로 데이터를 요청하여 수집
- **장점**: 중앙 집중식 관리, 데이터 일관성
- **단점**: 폴링 주기에 따른 지연
- **예시**: Prometheus, Nagios

---

## ○ SLI/SLO/SLA 관계

### **SLI (Service Level Indicator)**

- **정의**: 서비스 수준을 측정하는 지표
- **예시**: 응답시간, 가용성, 에러율

### **SLO (Service Level Objective)**

- **정의**: SLI에 대한 목표값
- **예시**: "응답시간 95%가 1초 이하", "가용성 99.9%"

### **SLA (Service Level Agreement)**

- **정의**: 고객과의 서비스 수준 계약
- **예시**: "월 가용성 99.9% 미달 시 서비스 크레딧 제공"

---

## ○ 주요 모니터링 도구

### 🏗️ **인프라 모니터링**

#### Prometheus + Grafana

- **특징**: 오픈소스, Pull 기반, 시계열 DB
- **장점**: 강력한 쿼리 언어(PromQL), 확장성
- **사용 사례**: 컨테이너 환경, 마이크로서비스

#### Zabbix

- **특징**: 에이전트 기반, 통합 모니터링 플랫폼
- **장점**: 다양한 모니터링 방식 지원, 강력한 알림
- **사용 사례**: 전통적인 인프라, 엔터프라이즈

#### Nagios

- **특징**: 호스트/서비스 상태 모니터링
- **장점**: 안정성, 플러그인 생태계
- **사용 사례**: 네트워크 장비, 서버 상태 체크

### 📱 **APM (Application Performance Monitoring)**

#### New Relic

- **특징**: SaaS 기반, 자동 계측
- **장점**: 사용 편의성, 다양한 언어 지원
- **사용 사례**: 웹 애플리케이션, 모바일 앱

#### DataDog

- **특징**: 통합 모니터링 플랫폼
- **장점**: 인프라 + APM 통합, 강력한 대시보드
- **사용 사례**: 클라우드 네이티브 환경

#### Pinpoint (Naver)

- **특징**: 오픈소스, 분산 추적 특화
- **장점**: 한국어 지원, 무료
- **사용 사례**: Java 애플리케이션 성능 분석

### 📊 **로그 분석**

#### ELK Stack

- **구성**: Elasticsearch + Logstash + Kibana
- **특징**: 실시간 로그 검색 및 분석
- **장점**: 강력한 검색, 시각화
- **사용 사례**: 중앙화된 로그 관리

#### Fluentd

- **특징**: 데이터 수집기, 통합 로깅 레이어
- **장점**: 플러그인 생태계, 메모리 효율성
- **사용 사례**: 다양한 소스의 로그 통합

---

## ○ 알림 전략 및 피로도 방지

### 🚨 **알림 레벨 설정**

- **P0 (Critical)**: 즉시 대응 필요, 24/7 알림
- **P1 (High)**: 1시간 내 대응, 업무시간 알림
- **P2 (Medium)**: 당일 대응, 이메일 알림
- **P3 (Low)**: 모니터링만, 대시보드 표시

### 📢 **알림 채널**

- **즉시**: SMS, 전화, Slack/Teams
- **일반**: 이메일, 모바일 푸시
- **정보**: 대시보드, 주간 리포트

### 🔕 **알림 피로도 방지**

- **Threshold 조정**: 너무 민감하지 않게 설정
- **시간 기반 필터링**: 업무시간/비업무시간 구분
- **그룹핑**: 연관된 알림을 묶어서 전송
- **Auto-resolution**: 문제 해결 시 자동으로 알림 해제

---

## ○ 모니터링 구현 단계

### 1️⃣ **계획 수립**

- 모니터링 목표 정의
- 대상 시스템 식별
- SLI/SLO 설정

### 2️⃣ **도구 선택**

- 환경에 적합한 도구 선정
- 에이전트 vs 에이전트리스 결정
- 비용 및 유지보수 고려

### 3️⃣ **구축 및 설정**

- 모니터링 인프라 구축
- 메트릭 수집 설정
- 대시보드 구성

### 4️⃣ **알림 설정**

- 임계값 설정
- 알림 채널 구성
- 에스컬레이션 정책 수립

### 5️⃣ **운영 및 개선**

- 지속적인 튜닝
- 알림 피로도 관리
- 용량 계획 수립

---

### 용어

- **SRE**: Site Reliability Engineering, 사이트 신뢰성 엔지니어링
- **MTTR**: Mean Time To Recovery, 평균 복구 시간
- **MTBF**: Mean Time Between Failures, 평균 고장 간격
- **APM**: Application Performance Monitoring, 애플리케이션 성능 모니터링
- **Observability**: 관측 가능성, 시스템 내부 상태를 외부에서 파악할 수 있는 능력

---

[참고: Google SRE Book](https://sre.google/sre-book/table-of-contents/)  
[참고: Prometheus 모니터링](https://prometheus.io/docs/introduction/overview/)  
[참고: 모니터링의 필요성 및 주요지표](https://dream-coding.tistory.com/45)
